## Сравнение модулей
### tabula-py 1.4.1
* [oписание и документация](https://tabula-py.readthedocs.io/en/latest/)
* проблемы:
    * первая строка распознается как заголовок
    * объединение нескольких колонок в одну
    * не распознается продолжение таблицы на след. стр.
    * в таблицу вставляются колонки с пустыми значениями
### camelot-py 0.8.2
* [описание и документация](https://camelot-py.readthedocs.io/en/master/)
* проблемы:
    * распознает как строки таблицы весть текст документа
    * не выделяет колонки
    * новую стр. в документе относит кновойтаблиуе (не распознает продолжение)
    * 09.09.2020 как выяснилось позже, в модуле нет контроля над функцией удаления пробелов в начале и/или конце строки, а сохранение этих пробелов оказалось критически важно дляобработки "висячих" строк в таблицах
### PDFLayoutTextStripper 2.2.3 (рекомендуется в [описании](task_description/PDF%20Invoice%20Parsing.docx) задания)
* [описание и документация](https://github.com/JonathanLink/PDFLayoutTextStripper) (java class for Apache PDFBox)
* [python API](https://github.com/thoqbk/PDFLayoutTextStripper) / [py4j](https://www.py4j.org/py4j_java_gateway.html#examples) (java to python)
* проблемы:
    * ошибка на файле [sysco PO#_077-2706402.pdf](task_description/examples/sysco%20PO#_077-2706402.pdf):
    ```python
    {'success': 'false', 'error': 'String index out of range: -1'}
    ```
### pdftotext 2.1.5 (рекомендуется в [описании](task_description/PDF%20Invoice%20Parsing.docx) задания)
* [описание и документация](https://github.com/jalan/pdftotext)
* проблемы:
    * однострочные заголовки таблиц могут дробиться на несколько рядов
    * 09.09.2020 как выяснилось позже, в последних (?) строках таблиц часто встречается количество пробелов междуэлементами отличное от количества пробелов в аналогичных строках выше, из-за чего некорректно работает алгоритм разбиения строк на столбцы таблицы

### pdfminer.six 20200726
* [описание и документация](https://pdfminersix.readthedocs.io/en/latest/)
* проблемы:
    * сложный API ([пример извлечения текста](https://pdfminersix.readthedocs.io/en/latest/tutorial/composable.html))
### Резюме:
* примеры работы модулей- см. [ноутбук](scripts/notebooks/compare_modules.ipynb)
* все модули требуют значительной дополнительной работы с текстом
* *camelot*, *pdflayouttextstripper*, *pdftotext* сохраняют максимум входной информации (два последних - в т.ч. и layout документа). Но:
    * *camelot* работает значительно дольше *pdftotext*
    * *pdflayouttextstripper* не принимает некоторые документы
    * *pdftotext* склонен дробить одну строку текста (с подчеркиванием) на несколько блоков (отельных строк)
* с помощью *pdftotext* и *camelot* можно добиться схожих результатов, ~~будем продолжать работу с этими модулями~~
* 09.09.2020 с версии [PDFparser_v_02](scripts/v_02/pdf_parser_class.py) для распознания текста исп. модуль *pdfminer*, т.к. он сохраняет отступы в начале и конце строки, что важно для обработки "висячих" строк

## Эвристики (требования к входным файлам)
1. Строки таблицы в документе имеют нумерацыю, начинаются с 1.
2. Заголовок таблицы (возможно, несколько строк) расположен непосредственно над первой строкой таблицы и ограничен разделительными линиями сверху и снизу (или только сверху).
3. Разделительная линия (separator) состоит из одного символа, повторяющегося по не менее, чем на 50% ширины строки документа.
4. Основная строка таблицы - строка, начинающаяся с возрастающего порядкового номера и заполненная не менее, чем на 60% ширины строки документа.
5. Таблица может содержать промежуточные строки, расположенные непосредственно под соответствующей основной строкой (вследствие расположения текста в некоторых ячейках в два ряда).
6. Таблица может продолжаться на второй странице документа, тогда ей предшествует вточности шапка (допускается отличие с номере страницы(один знак)) и заголовок.
7. Cтроки таблицы разбиваются на колонки на основаниии промежутков между ее элементами. Элементы объединяются в колонку до тех пор, пока расстояние между ними = 1 пробел, а растояние до ближайшей группы элементов справа и слева  > 1 пробел. "Правильное" количество колонок при этом определяется по моде с учетом всех строк в таблице. Если количество колонок в отдельной строке не равно моде, значения в ячейках заменяются на "н/д".
8. Если по п.7 в одну колонку попадают элементы, состоящие исключительно из цифр, и внутри этой колонки можно разделить текст каждой из строк по "пробелам" таким образом, что "цифровые" элементы формируют отдельную субколонку во всех строках, то исходная колонка разбивается на соответствующее количесво новых колонок.

## TODO
1. ~~Решить вопрос с ошибкой ```{'success': 'false', 'error': 'String index out of range: -1'}``` в *PDFLayoutTextStripper*~~
    * 23.08.2020 - все файлы типа *sysco PO#_077-2706402.pdf* имеют bookmarks. Удалил закладки через [avepdf.com](https://avepdf.com/en/remove-pdf-content) + при удалении обновляется версия pdf c 1.0 до 1.5. Изм. файл [sysco PO#_077-2706402_no_bmrks.pdf](task_description/examples/no_bookmarks/sysco%20PO#_077-2706402_no_bmrks.pdf) дает ту же ошибку.
    * 24.08.2020 - отказ от работы с модулем *pdflayouttextstripper* в пользу других модулей
2. Написать модуль для распознания структуры документа на основе [эвристик](https://github.com/woldemarg/pdf_parser#%D1%8D%D0%B2%D1%80%D0%B8%D1%81%D1%82%D0%B8%D0%BA%D0%B8-%D0%B4%D0%BB%D1%8F-%D0%B2%D1%8B%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86---%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D0%B2%D1%85%D0%BE%D0%B4%D0%BD%D1%8B%D0%BC-%D1%84%D0%B0%D0%B9%D0%BB%D0%B0%D0%BC)
    * 28.08.2020 - [кастомный модуль](scripts/v_01/pdf_parser_class.py) и результаты его работы на примерах документов - см. [ноутбук](scripts/notebooks/pdf_parser_test.ipynb)
    * 02.09.2020 - пересмотреть класс:
        * ~~почему под каждый документ нужно создавать новый экземпляяр класса?~~ - решено 07.09.2020
        * ~~возможно возвращать только строки, "обрезанные" слева, чтобы корректно обрабатывать "висячие" строки таблиц и заголовков~~ - решено 09.09.2020 с переходом на исп. в [PDFparser_v_02](scripts/v_02/pdf_parser_class.py) модуля *pdfminer*
        * ~~определиться и пересмотреть метод по умолчанию (возможно, "camelot" - по итогам [распознания структуры таблиц](scripts/notebooks/parser_table_test.ipynb))~~ - решено 09.09.2020 (см. [Сравнение модулей](https://github.com/woldemarg/pdf_parser#%D1%81%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D0%B5%D0%B9))
3. Расширить модуль для распознания структуры таблицы и заголовка
    * 02.09.2020 - метод распознанния структуры таблицы (см. [ноутбук](scripts/notebooks/parser_table_test.ipynb)) вкл. в модуль *PDFparser*
    * 09.09.2020 - выделение таблицы и обработку "висячих" строк объединить в метод класса *PDFparser* (см. [ноутбук](scripts/notebooks/full_table_extract.ipynb))
4. Расширить модуль для выделения информации из header и footer документа
5. Поместить модуль в обособленный контейнер
    * 31.08.2020 - перешел на разработку в виртуальной среде (файл [requirements.txt](requirements.txt) пока вкл. модули и для Spyder)
